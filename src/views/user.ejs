<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daftar User - LabCorner</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- jsPDF + autoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <style>
    .fade-in { animation: fadeIn 0.5s ease-out both; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-scale-in {
      animation: scaleIn 0.3s ease-out both;
    }
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-purple-300 to-indigo-600 min-h-screen text-gray-900 font-[Inter]">

<div class="max-w-6xl mx-auto px-6 py-12 space-y-10">

  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-center gap-6 fade-in">
    <h2 class="text-5xl font-extrabold text-white drop-shadow">📋 Daftar User</h2>
    <button onclick="exportPDF()" class="bg-white text-purple-700 font-bold px-8 py-3 rounded-xl shadow-lg hover:bg-purple-100 hover:text-purple-800 active:scale-95 transition-transform duration-300 text-lg">
      📄 Ekspor PDF
    </button>
  </div>

  <!-- Search -->
  <div class="flex flex-col sm:flex-row justify-between items-center gap-6 fade-in">
    <input id="searchUser" type="text" placeholder="🔍 Cari user..." class="form-input shadow w-full sm:w-1/2 text-lg px-4 py-2 rounded-lg focus:ring-2 focus:ring-purple-400 transition" />
    <button onclick="resetSearch()" class="text-white text-base underline hover:text-purple-200 active:scale-95 transition-transform">🔁 Reset Pencarian</button>
  </div>

  <!-- Count -->
  <p id="userCount" class="text-white/90 text-base mb-4 font-medium fade-in">Menampilkan 1 user</p>

  <!-- Tabel -->
  <div class="bg-white/90 backdrop-blur rounded-2xl shadow-xl overflow-x-auto fade-in transition-all">
    <table class="w-full text-lg text-left text-gray-800" id="userTable">
      <thead>
        <tr class="bg-purple-100 text-gray-700 font-bold text-xl">
          <th class="py-5 px-6">👤 Nama</th>
          <th class="py-5 px-6">🆔 Username</th>
          <th class="py-5 px-6">🎓 Peran</th>
          <th class="py-5 px-6 text-center">⚙️ Aksi</th>
        </tr>
      </thead>
      <tbody class="divide-y text-base">
        <tr class="hover:bg-purple-50 transition-all duration-200">
          <td class="px-6 py-5 font-semibold">Aufa Lubis</td>
          <td class="px-6 py-5">aufa123</td>
          <td class="px-6 py-5">Admin</td>
          <td class="px-6 py-5 text-center">
            <button onclick="toggleEdit(0)" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-full shadow transition-all transform hover:scale-105 active:scale-95 text-base">
              ✏️ Edit
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    <div id="noResult" class="text-center text-red-600 py-6 hidden text-lg font-semibold">❌ Data user tidak ditemukan</div>
  </div>

  <!-- Editor -->
  <div id="editSection" class="hidden bg-white/90 backdrop-blur rounded-2xl p-8 shadow-xl animate-scale-in">
    <h3 class="text-2xl font-bold text-purple-700 mb-6">🛠️ Edit User</h3>
    <form onsubmit="submitEdit(event)" class="space-y-6">
      <div class="grid md:grid-cols-3 gap-6">
        <input id="edit-nama" type="text" class="form-input text-lg px-4 py-2 rounded-lg" required />
        <input id="edit-username" type="text" class="form-input text-lg px-4 py-2 rounded-lg" required />
        <select id="edit-peran" class="form-input text-lg px-4 py-2 rounded-lg">
          <option value="Admin">Admin</option>
          <option value="Mahasiswa">Mahasiswa</option>
          <option value="Asisten">Asisten</option>
        </select>
      </div>
      <div class="text-right">
        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-3 rounded-full text-lg shadow transition-transform transform hover:scale-105 active:scale-95">
          💾 Simpan Perubahan
        </button>
      </div>
    </form>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-6 right-6 bg-green-600 text-white px-6 py-4 rounded-xl shadow-xl hidden transition-all duration-500 z-50 text-base">
    Perubahan disimpan!
  </div>
</div>

<!-- Script -->
<script>
  let currentIndex = null;

  function toggleEdit(index) {
    currentIndex = index;
    const row = document.querySelectorAll("#userTable tbody tr")[index];
    document.getElementById("edit-nama").value = row.children[0].innerText;
    document.getElementById("edit-username").value = row.children[1].innerText;
    document.getElementById("edit-peran").value = row.children[2].innerText;

    document.getElementById("editSection").classList.remove("hidden");
    window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
  }

  function submitEdit(e) {
    e.preventDefault();
    const rows = document.querySelectorAll("#userTable tbody tr");
    if (currentIndex !== null && rows[currentIndex]) {
      rows[currentIndex].children[0].innerText = document.getElementById("edit-nama").value;
      rows[currentIndex].children[1].innerText = document.getElementById("edit-username").value;
      rows[currentIndex].children[2].innerText = document.getElementById("edit-peran").value;
    }

    showToast("Perubahan disimpan!");
    document.getElementById("editSection").classList.add("hidden");
  }

  function showToast(msg) {
    const toast = document.getElementById("toast");
    toast.textContent = msg;
    toast.classList.remove("hidden");
    toast.style.opacity = "1";
    setTimeout(() => {
      toast.style.opacity = "0";
      setTimeout(() => toast.classList.add("hidden"), 500);
    }, 2000);
  }

  function resetSearch() {
    document.getElementById("searchUser").value = "";
    document.querySelectorAll("#userTable tbody tr").forEach(row => row.style.display = "");
    document.getElementById("noResult").classList.add("hidden");
    updateCount();
  }

  document.getElementById("searchUser").addEventListener("input", function () {
    const keyword = this.value.toLowerCase();
    let found = false;
    document.querySelectorAll("#userTable tbody tr").forEach(row => {
      const match = row.innerText.toLowerCase().includes(keyword);
      row.style.display = match ? "" : "none";
      if (match) found = true;
    });
    document.getElementById("noResult").classList.toggle("hidden", found);
    updateCount();
  });

  function updateCount() {
    const visible = Array.from(document.querySelectorAll("#userTable tbody tr"))
      .filter(row => row.style.display !== "none").length;
    document.getElementById("userCount").textContent = `Menampilkan ${visible} user`;
  }

  window.onload = updateCount;

  async function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF("p", "mm", "a4");

    const title = "📋 Daftar User - LabCorner";
    const subtitle = `📅 Dicetak pada: ${new Date().toLocaleDateString("id-ID", {
      weekday: "long", year: "numeric", month: "long", day: "numeric"
    })}`;

    const headers = [["Nama", "Username", "Peran"]];
    const rows = [];

    document.querySelectorAll("#userTable tbody tr").forEach(row => {
      if (row.style.display === "none") return;
      const cols = row.querySelectorAll("td");
      if (cols.length >= 3) {
        rows.push([
          cols[0].innerText.trim(),
          cols[1].innerText.trim(),
          cols[2].innerText.trim()
        ]);
      }
    });

    if (!rows.length) {
      alert("❌ Tidak ada data user yang bisa diekspor.");
      return;
    }

    // Header
    doc.setFont("helvetica", "bold");
    doc.setFontSize(18);
    doc.setTextColor(40, 40, 60);
    doc.text(title, 14, 20);

    doc.setFont("helvetica", "normal");
    doc.setFontSize(11);
    doc.setTextColor(80, 80, 80);
    doc.text(subtitle, 14, 28);

    doc.autoTable({
      head: headers,
      body: rows,
      startY: 36,
      theme: "grid",
      headStyles: {
        fillColor: [103, 58, 183],
        textColor: 255,
        fontSize: 11,
        halign: "center"
      },
      bodyStyles: {
        halign: "center",
        textColor: [50, 50, 50],
      },
      alternateRowStyles: {
        fillColor: [245, 240, 255],
      },
      styles: {
        font: "helvetica",
        fontSize: 10,
        cellPadding: 5,
        lineColor: [200, 200, 200],
        lineWidth: 0.2,
      },
      didDrawPage: function (data) {
        const pageSize = doc.internal.pageSize;
        const pageHeight = pageSize.height || doc.internal.pageSize.getHeight();
        const pageWidth = pageSize.width || doc.internal.pageSize.getWidth();

        doc.setFontSize(9);
        doc.setTextColor(120);
        doc.text(`LabCorner © ${new Date().getFullYear()}`, 14, pageHeight - 10);
        doc.text(`Halaman ${doc.internal.getNumberOfPages()}`, pageWidth - 40, pageHeight - 10);
      }
    });

    doc.save("daftar_user_labcorner.pdf");
  }
</script>

</body>
</html>
