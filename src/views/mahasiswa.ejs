<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jadwal Praktikum</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .fade-slide {
      animation: fadeSlide 0.5s ease-in-out;
    }
    @keyframes fadeSlide {
      0% {
        opacity: 0;
        transform: translateY(12px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body class="bg-[#A188E3] min-h-screen">
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-72 bg-[#6D28D9] text-white flex flex-col p-4">
      <div class="text-2xl font-bold tracking-wide mb-8">LABCORNER</div>
      <nav class="flex flex-col gap-4">
        <a href="/lab" class="flex items-center gap-3 p-3 text-white/80 hover:bg-white/10 rounded-lg">
          <span>Home Lab</span>
        </a>
        <a href="#" class="flex items-center gap-3 p-3 bg-white/20 rounded-lg shadow ring-1 ring-white/20 font-semibold">
          <span>Jadwal Praktikum</span>
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-y-auto">
      <header class="flex justify-between items-center px-6 py-4 bg-white shadow">
        <h1 class="text-xl font-bold text-[#6D28D9]">Pengelolaan Kehadiran Mahasiswa</h1>
      </header>

      <main class="p-8 space-y-6">
        <!-- Search & Controls -->
        <div class="flex flex-wrap justify-between items-center gap-4">
          <form method="GET" action="/api/mahasiswa" class="w-full md:w-1/2">
            <input type="text" name="q" placeholder="Cari Nama Mahasiswa"
              class="w-full p-3 rounded-full border border-gray-300 shadow-md transition focus:ring-2 focus:ring-purple-500" />
          </form>

          <div class="flex items-center space-x-2">
            <select id="semesterSelect"
              class="px-4 py-2 rounded-full shadow bg-white border border-gray-300 text-gray-800">
              <option value="">Pilih Kelas</option>
              <option value="Kelas A">Kelas A</option>
              <option value="Kelas B">Kelas B</option>
            </select>

            <a href="/api/mahasiswa/rekap"
              class="bg-purple-800 text-white px-4 py-2 rounded-full shadow hover:bg-purple-900 transition">
              Rekap Absen
            </a>
          </div>
        </div>

        <!-- Daftar Mahasiswa -->
        <div class="bg-white p-6 rounded-xl shadow-xl fade-slide">
          <h2 class="text-xl font-semibold text-gray-800 mb-4">Nama Anggota Kelas</h2>
          <div class="space-y-3">
            <% if (mahasiswa && mahasiswa.length === 0) { %>
              <p class="text-center text-gray-500">Belum ada data mahasiswa untuk semester ini.</p>
            <% } else if (mahasiswa) { %>
              <% mahasiswa.forEach((m) => { %>
                <form action="/api/update-status/<%= m.id %>" method="POST" class="transition-all duration-200">
                  <div class="flex flex-wrap justify-between items-center px-6 py-3 rounded-full bg-gray-100 hover:bg-gray-200">
                    <span class="text-gray-700 font-medium mb-2 md:mb-0"><%= m.nama %> - <%= m.rekap %></span>
                    <div class="flex items-center gap-2">
                      <select name="status" class="rounded-full px-3 py-1 border border-gray-300">
                        <option value="Hadir" <%= m.status === 'Hadir' ? 'selected' : '' %>>Hadir</option>
                        <option value="Tidak Hadir" <%= m.status === 'Tidak Hadir' ? 'selected' : '' %>>Tidak Hadir</option>
                      </select>
                      <button type="submit"
                        class="px-4 py-1 bg-blue-600 text-white rounded-full text-sm hover:bg-blue-700 transition">Update</button>
                    </div>
                  </div>
                </form>
              <% }) %>
            <% } %>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    document.getElementById('semesterSelect')?.addEventListener('change', function () {
      if (this.value) {
        window.location.href = `/api/filter-semester?semester=${this.value}`;
      }
    });
  </script>
</body>
</html>